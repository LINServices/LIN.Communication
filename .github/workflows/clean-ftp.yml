name: Run CSX

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  run-csx:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        dotnet: ["9.0.x"]  # usa 8.0.x si prefieres LTS
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET ${{ matrix.dotnet }}
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: ${{ matrix.dotnet }}

      - name: Install dotnet-script (global)
        run: dotnet tool install -g dotnet-script

      - name: Add tools to PATH
        run: echo "$HOME/.dotnet/tools" >> "$GITHUB_PATH"

      - name: Cache NuGet
        uses: actions/cache@v4
        with:
          path: ~/.nuget/packages
          key: nuget-${{ runner.os }}-${{ hashFiles('**/packages.lock.json', '**/*.csproj') }}
          restore-keys: |
            nuget-${{ runner.os }}-

      - name: Run all .csx in folder
        env:
          FTP_HOST: ${{ secrets.FTP_HOST }}
          FTP_USER: ${{ secrets.FTP_USER }}
          FTP_PASS: ${{ secrets.FTP_PASS }}
          FTP_DIR: ${{ secrets.FTP_DIR }}
        run: |
          find ./Scripts -name "*.csx" -print -exec dotnet-script {} \;
